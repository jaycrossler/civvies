/*! civvies.js - civvies, Minified on 2015-10-23 */

_.mixin({deepClone:function(a){return JSON.parse(JSON.stringify(a))}});var maths={};maths.clamp=function(a,b,c){return Math.min(Math.max(a,b),c)},maths.heightOnSin=function(a,b,c,d,e,f){f=f||Math.sin;var g=c/d,h=a+(b-a)*g;return Math.sin(h*Math.PI)*e},maths.sizeFromAmountRange=function(a,b,c,d,e){var f=(c-d)/(e-d);return a+f*(b-a)},maths.colorBlendFromAmountRange=function(a,b,c,d,e){var f=(c-d)/(e-d);"#"==a.substring(0,1)&&(a=a.substring(1,7)),"#"==b.substring(0,1)&&(b=b.substring(1,7));var g=a.substring(0,2),h=a.substring(2,4),i=a.substring(4,6),j=b.substring(0,2),k=b.substring(2,4),l=b.substring(4,6),m=Math.abs(parseInt(parseInt(g,16)*f+parseInt(j,16)*(1-f))),n=Math.abs(parseInt(parseInt(h,16)*f+parseInt(k,16)*(1-f))),o=Math.abs(parseInt(parseInt(i,16)*f+parseInt(l,16)*(1-f))),p=maths.decimalToHex(m)+maths.decimalToHex(n)+maths.decimalToHex(o);return"#"+p},maths.decimalToHex=function(a,b){var c=Number(a).toString(16);for(b="undefined"==typeof b||null===b?b=2:b;c.length<b;)c="0"+c;return c},maths.idealTextColor=function(a){var b=150,c=maths.getRGBComponents(a),d=.299*c.R+.587*c.G+.114*c.B;return b>255-d?"#000000":"#ffffff"},maths.getRGBComponents=function(a){var b=a.substring(1,3),c=a.substring(3,5),d=a.substring(5,7);return{R:parseInt(b,16),G:parseInt(c,16),B:parseInt(d,16)}},maths.hexColorToRGBA=function(a,b){var c;if(!a)return"rgba(0,0,0,1)";var d,e;return 0==a.indexOf("rgb(")&&a.indexOf(",")>5?(d=a.substr(0,a.length-1),d=d.substr(4),e=d.split(","),c={R:e[0],G:e[1],B:e[2]}):0==a.indexOf("rgba(")&&a.indexOf(",")>5?(d=a.substr(0,a.length-1),d=d.substr(5),e=d.split(","),c={R:e[0],G:e[1],B:e[2]}):0==a.indexOf("#")?c=maths.getRGBComponents(a):(d=net.brehaut.Color(a).toString(),c=maths.getRGBComponents(d)),b=b||1,"rgba("+c.R+","+c.G+","+c.B+","+b+")"},maths.buildTransformFromTriangleToTriangle=function(a,b){var c=a[0].x,d=a[0].y,e=a[1].x,f=a[1].y,g=a[2].x,h=a[2].y,i=b[0].x,j=b[0].y,k=b[1].x,l=b[1].y,m=b[2].x,n=b[2].y,o=((i-k)*(d-h)-(i-m)*(d-f))/((c-e)*(d-h)-(c-g)*(d-f)),p=((i-k)*(c-g)-(i-m)*(c-e))/((d-f)*(c-g)-(d-h)*(c-e)),q=i-o*c-p*d,r=((j-l)*(d-h)-(j-n)*(d-f))/((c-e)*(d-h)-(c-g)*(d-f)),s=((j-l)*(c-g)-(j-n)*(c-e))/((d-f)*(c-g)-(d-h)*(c-e)),t=j-r*c-s*d;return[o,r,p,s,q,t]};var Helpers=Helpers||{};Helpers.between=function(a,b,c,d,e){if(!a.lastIndexOf||!a.indexOf)return a;var f=e?a.lastIndexOf(b):a.indexOf(b);if(!(f>=0))return"";if(a=a.substring(f+b.length),c){if(f=d?a.lastIndexOf(c):a.indexOf(c),!(f>=0))return"";a=a.substring(0,f)}return a},Helpers.sortWithConditions=function(a,b){b=b||"name";var c,d,e,f,g,h,i,j,k=[],l=[];for(c=0;c<a.length;c++)f=a[c],f.after||f.above?l.push(f):k.push(f);var m=0;for(c=0;c<l.length;c++){f=l[c],g=f.after||f.above,_.isArray(g)||(g=[g]),h=0;var n=0;for(d=0;d<g.length;d++)for(i=g[d],e=0;e<k.length;e++)if(j=k[e],i==j[b]){e+1>h&&(h=e+1),n++;break}n==g.length?k.splice(h,0,f):(k.push(f),m++)}for(c=k.length-m;c<k.length;c++){for(f=k[c],g=f.after||f.above,_.isArray(g)||(g=[g]),h=0,d=0;d<g.length;d++)for(i=g[d],e=0;e<k.length;e++)if(j=k[e],i==j[b]){e>h&&(h=e+1);break}k.splice(c,1),k.splice(h,0,f)}return k},Helpers.randomSetSeed=function(a){Helpers._randseed=a||42},Helpers.random=function(){Helpers._randseed=Helpers._randseed||42;var a=1e4*Math.sin(Helpers._randseed++);return a-Math.floor(a)},Helpers.randInt=function(a){return a=a||100,parseInt(Helpers.random()*a+1)},Helpers.randOption=function(a){var b=a.length;return a[Helpers.randInt(b)-1]},Helpers.dateFromPythonDate=function(a,b){"None"==a&&(a=void 0),null==a&&(a=void 0),""==a&&(a=void 0);var c=b;return a&&(a=a.replace(/p.m./,"pm"),a=a.replace(/a.m./,"am"),a=a.replace(/\. /," "),c=moment(a)),c&&c.isValid&&!c.isValid()&&(c=b||moment()),c},Helpers.knownFileExt=function(a){var b=",3gp,7z,ace,ai,aif,aiff,amr,asf,aspx,asx,bat,bin,bmp,bup,cab,cbr,cda,cdl,cdr,chm,dat,divx,dll,dmg,doc,docx,dss,dvf,dwg,eml,eps,exe,fla,flv,gif,gz,hqx,htm,html,ifo,indd,iso,jar,jp2,jpeg,jpg,kml,kmz,lnk,log,m4a,m4b,m4p,m4v,mcd,mdb,mid,mov,mp2,mp4,mpeg,mpg,msi,mswmm,ogg,pdf,png,pps,ppt,pptx,ps,psd,pst,ptb,pub,qbb,qbw,qxd,ram,rar,rm,rmvb,rtf,sea,ses,sit,sitx,ss,swf,tgz,thm,tif,tmp,torrent,ttf,txt,vcd,vob,wav,wma,wmv,wps,xls,xpi,zip,";return b.indexOf(","+a+",")>-1},Helpers.thousandsFormatter=function(a){return a>999?(a/1e3).toFixed(1)+"k":a},Helpers.expandExponential=function(a){if(1e20>a)return a;var a=a+"";return a=a.replace(/^([+-])?(\d+).?(\d*)[eE]([-+]?\d+)$/,function(a,b,c,d,e){var f=0>+e,g=c.length+ +e,a=(f?c:d).length,e=(e=Math.abs(e))>=a?e-a+f:0,h=new Array(e+1).join("0"),i=c+d;return(b||"")+(f?i=h+i:i+=h).substr(0,g+=f?h.length:0)+(g<i.length?"."+i.substr(g):"")})},Helpers.abbreviateNumber=function(a,b,c){c&&1e6>a&&(a=parseInt(a));var d=a;if(a>=1e4){a=Helpers.expandExponential(a);for(var e=b?[""," thousand"," million"," billion"," trillion"," quadrillion"," pentillion"," sextillion"," septillion"]:["","k","m","b","t","q","p","s","ss"],f=Math.floor((""+a).length/3),g="",h=2;h>=1;h--){g=parseFloat((0!=f?a/Math.pow(1e3,f):a).toPrecision(h));var i=(g+"").replace(/[^a-zA-Z 0-9]+/g,"");if(i.length<=2)break}d=g+e[f]}else d=d.toLocaleString();return d},Helpers.invertColor=function(a){var b=a;return b=b.substring(1),b=parseInt(b,16),b=16777215^b,b=b.toString(16),b=("000000"+b).slice(-6),b="#"+b},Helpers.rgb2hex=function(a){function b(a){return("0"+parseInt(a).toString(16)).slice(-2)}return"string"!=typeof a?a:a&&-1==a.search("rgb")?(a=a.split(","),a.length>=3?"#"+b(a[0])+b(a[1])+b(a[2]):a):a?(a=a.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+))?\)$/),"#"+b(a[1])+b(a[2])+b(a[3])):a},Helpers.getRGBComponents=function(a){var b=a.substring(1,3),c=a.substring(3,5),d=a.substring(5,7);return{R:parseInt(b,16),G:parseInt(c,16),B:parseInt(d,16)}},Helpers.idealTextColor=function(a){4===a.length&&(a="#"+a[1]+a[1]+a[2]+a[2]+a[3]+a);var b=105,c=Helpers.getRGBComponents(a),d=.299*c.R+.587*c.G+.114*c.B;return b>255-d?"#000000":"#ffffff"},Helpers.getColorWithBackground=function(a,b){var c=Helpers.rgb2hex(a),d=b?Helpers.invertColor(c):Helpers.idealTextColor("#"+c);return d},Helpers.getQueryString=function(){for(var a,b={},c=location.search.substring(1),d=/([^&=]+)=([^&]*)/g;a=d.exec(c);)b[decodeURIComponent(a[1])]=decodeURIComponent(a[2]);return b},Helpers.exists=function(){for(var a=!0,b=0;b<arguments.length;b++)if("undefined"==typeof arguments[b]){a=!1;break}return a},Helpers.upperCase=function(a,b){return"undefined"!=typeof a?b?a.replace(/\w\S*/g,function(a){return a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()}):a.charAt(0).toUpperCase()+a.slice(1):void 0},Helpers.MakeSureClassExists=function(pointer){var classArr=pointer.split("."),newClass={};if(classArr.length&&classArr.length>0){var rootClass=classArr[0];window[rootClass]?newClass=window[rootClass]:eval(rootClass+" = {}");for(var classEval=rootClass,i=1;i<classArr.length;i++)classEval+="['"+classArr[i]+"']","undefined"==eval("typeof "+classEval)&&eval(classEval+" = {}")}},Helpers.dateCameBefore=function(a){var b=!1,c=!1;if(a&&a.isValid?b=!0:a=moment(a),a&&a.isValid&&a.isValid()){var d=moment(),e=d.diff(a);e>0&&(c=!0)}else c="Invalid Date";return c},Helpers.buildBootstrapDropdown=function(a,b){var c=$("<span class='btn-group'>");$("<a class='btn dropdown-toggle btn-mini' data-toggle='dropdown' href='#'>"+a+"<span class='caret'></span></a>").appendTo(c);var d=$("<ul class='dropdown-menu'>").appendTo(c);return _.each(b,function(a){var b=$("<li>").appendTo(d),c=$("<a>").attr({target:"_blank",alt:a.alt||a.name||""}).text(a.title||"Item").appendTo(b);a.url&&c.attr({href:a.href}),a.onclick&&c.on("click",a.onclick)}),c},Helpers.buildBootstrapInputDropdown=function(a,b,c){var d=$("<span class='input-append btn-group'>"),e=$("<a class='btn dropdown-toggle btn-mini' data-toggle='dropdown' href='#'>").css({"float":"none"}).appendTo(d),f=$("<span>").text(a).appendTo(e);$("<span>").addClass("caret").appendTo(e);var g=$("<ul class='dropdown-menu'>").appendTo(d);return _.each(b,function(a){var b=$("<li>").appendTo(g),d=$("<a>").attr({alt:a.alt||a.name||""}).attr({href:"#"}).on("click",function(){var a=$(this).text();c.val(a),f.text(a)}).appendTo(b);a.imgSrc&&$("<img>").attr({src:a.imgSrc}).appendTo(d),$("<span>").text(a.title||"Item").appendTo(d)}),d},Helpers.tryToMakeDate=function(a,b){var c,d=b&&b.toLowerCase?b.toLowerCase():"";if(d&&("date"==d||"created"==d||"updated"==d||"datetime"==d)){var e=moment(a);e.isValid()&&(c=a+" <b>("+e.calendar()+")</b>")}return c||a},Helpers.randomLetters=function(a){var b="";a=a||1;for(var c=0;a>c;c++)b+=String.fromCharCode("a".charCodeAt(0)+26*Math.random()-1);return b},Helpers.pluralize=function(a){var b=["equipment","information","rice","money","species","series","fish","sheep","moose","deer","news","food","wood","ore"],c=[[new RegExp("(m)an$","gi"),"$1en"],[new RegExp("(pe)rson$","gi"),"$1ople"],[new RegExp("(child)$","gi"),"$1ren"],[new RegExp("^(ox)$","gi"),"$1en"],[new RegExp("(ax|test)is$","gi"),"$1es"],[new RegExp("(octop|vir)us$","gi"),"$1i"],[new RegExp("(alias|status)$","gi"),"$1es"],[new RegExp("(bu)s$","gi"),"$1ses"],[new RegExp("(buffal|tomat|potat)o$","gi"),"$1oes"],[new RegExp("([ti])um$","gi"),"$1a"],[new RegExp("sis$","gi"),"ses"],[new RegExp("(?:([^f])fe|([lr])f)$","gi"),"$1$2ves"],[new RegExp("(hive)$","gi"),"$1s"],[new RegExp("([^aeiouy]|qu)y$","gi"),"$1ies"],[new RegExp("(x|ch|ss|sh)$","gi"),"$1es"],[new RegExp("(matr|vert|ind)ix|ex$","gi"),"$1ices"],[new RegExp("([m|l])ouse$","gi"),"$1ice"],[new RegExp("(quiz)$","gi"),"$1zes"],[new RegExp("s$","gi"),"s"],[new RegExp("$","gi"),"s"]],d=_.indexOf(b,a.toLowerCase())>-1;if(!d)for(var e=0;e<c.length;e++)if(a.match(c[e][0])){a=a.replace(c[e][0],c[e][1]);break}return a},Helpers.stringAfterString=function(a,b,c){var d=a.indexOf(b);return Helpers.exists(d)&&d>-1?a.substr(d+b.length):c||a},Helpers.isNumeric=function(a){return!isNaN(parseFloat(a))&&isFinite(a)},Helpers.nameOfUSState=function(a,b){var c={AL:"Alabama",AK:"Alaska",AZ:"Arizona",AR:"Arkansas",CA:"California",CO:"Colorado",CT:"Connecticut",DE:"Delaware",DC:"District of Columbia",FL:"Florida",GA:"Georgia",HI:"Hawaii",ID:"Idaho",IL:"Illinois",IN:"Indiana",IA:"Iowa",KS:"Kansas",KY:"Kentucky",LA:"Louisiana",ME:"Maine",MD:"Maryland",MA:"Massachusetts",MI:"Michigan",MN:"Minnesota",MO:"Missouri",MT:"Montana",NE:"Nebraska",NV:"Nevada",NH:"New Hampshire",NJ:"New Jersey",NM:"New Mexico",NY:"New York",NC:"North Carolina",ND:"North Dakota",OH:"Ohio",OK:"Oklahoma",OR:"Oregon",PA:"Pennsylvania",RI:"Rhode Island",SC:"South Carolina",SD:"South Dakota",TN:"Tennessee",TX:"Texas",UT:"Utah",VT:"Vermont",VA:"Virginia",WA:"Washington",WV:"West Virginia",WI:"Wisconsin",WY:"Wyoming"},d=c[a.toUpperCase()],e="";return d&&(e=b?", "+d:d),e},Helpers.getQueryVariable=function(a){for(var b=window.location.search.substring(1),c=!1,d=b.split("&"),e=0;e<d.length;e++){var f=d[e].split("=");if(f[0]==a){c=f[1];break}}return c},Helpers.createCSSClass=function(a,b){if(document.styleSheets&&0!=document.getElementsByTagName("head").length){var c,d,e;if(document.styleSheets.length>0)for(g=0;g<document.styleSheets.length&&(document.styleSheets[g].disabled||(e=document.styleSheets[g].media,d=typeof e,"string"==d?(""==e||-1!=e.indexOf("screen"))&&(c=document.styleSheets[g]):"object"==d&&e.mediaText&&(""==e.mediaText||-1!=e.mediaText.indexOf("screen"))&&(c=document.styleSheets[g]),!Helpers.exists(c)));g++);if(Helpers.exists(c)){var f=document.createElement("style");for(f.type="text/css",document.getElementsByTagName("head")[0].appendChild(f),g=0;g<document.styleSheets.length;g++)document.styleSheets[g].disabled||(c=document.styleSheets[g]);e=c.media,d=typeof e}var g;if("string"==d){for(g=0;g<c.rules.length;g++)if(c.rules[g].selectorText.toLowerCase()==a.toLowerCase())return void(c.rules[g].style.cssText=b);c.addRule(a,b)}else if("object"==d){for(g=0;g<c.cssRules.length;g++)if(c.cssRules[g].selectorText&&c.cssRules[g].selectorText.toLowerCase()==a.toLowerCase())return void(c.cssRules[g].style.cssText=b);c.insertRule(a+"{"+b+"}",0)}}},Helpers.loadCSSFiles=function(a){"string"==typeof a&&(a=[a]),_.isArray(a)||(a=[]);for(var b=0;b<a.length;b++){var c=document.createElement("link");c.setAttribute("rel","stylesheet"),c.setAttribute("type","text/css"),c.setAttribute("href",a[b]),document.getElementsByTagName("head")[0].appendChild(c)}},Helpers.directoryOfPage=function(a){a=a||document.location.href;var b=a.lastIndexOf("/");return a.substr(0,b+1)},Helpers.randomcolor=function(a){if(!Helpers.exists(a))return"#"+Math.floor(16777215*Math.random()).toString(16);var b=[256*Math.random(),256*Math.random(),256*Math.random()],c=[51*a,51*a,51*a],d=[b[0]+c[0],b[1]+c[1],b[2]+c[2]].map(function(a){return Math.round(a/2)});return"rgb("+d.join(",")+")"},Helpers.randRange=function(a,b,c){var d=a+Math.random()*(b-a+1);return Helpers.exists(c)?Math.round(d-.5):d.toFixed(c)},Helpers.round=function(a,b){return Math.round(a*Math.pow(10,b))/Math.pow(10,b)},Helpers.hexFromDec=function(a){var b=Math.round(a).toString(16);return b.length>1||(b="0"+b),b},Helpers.randomcolor_basedon=function(a){a=a||"#505050",0==a.indexOf("#")&&(a=a.substr(1)),a.length&&3==a.length&&(a=a.substr(0,1)+"0"+a.substr(1,1)+"0"+a.substr(2,1)+"0");var b=parseInt(a.substr(0,2),16),c=parseInt(a.substr(2,2),16),d=parseInt(a.substr(4,2),16),e=16;return b=Helpers.hexFromDec(b+Helpers.randRange(0,e)-e/2),c=Helpers.hexFromDec(c+Helpers.math.randRange(0,e)-e/2),d=Helpers.hexFromDec(d+Helpers.math.randRange(0,e)-e/2),"#"+b+c+d},Helpers.color_transparency=function(a,b){a=a||"#505050",0==a.indexOf("#")&&(a=a.substr(1)),a.length&&3==a.length&&(a=a.substr(0,1)+"0"+a.substr(1,1)+"0"+a.substr(2,1)+"0");var c=parseInt(a.substr(0,2),16),d=parseInt(a.substr(2,2),16),e=parseInt(a.substr(4,2),16);return"rgba("+c+","+d+","+e+","+b+")"},Helpers.steppedGYR=function(a){a=a||0;var b;return b=.5>=a?Helpers.blendColors("#00ff00","#ffff00",2*a):Helpers.blendColors("#ffff00","#ff0000",2*(a-.5))},Helpers.blendColors=function(a,b,c){if("undefined"==typeof Colors)throw"Requires colors.min.js library";if(!a||!b)return a;a=0==a.indexOf("#")?a=Colors.hex2rgb(a):Colors.name2rgb(a),b=0==b.indexOf("#")?b=Colors.hex2rgb(b):Colors.name2rgb(b);var d=(b.R-a.R)*c,e=(b.G-a.G)*c,f=(b.B-a.B)*c,g=Colors.rgb2hex(parseInt(a.R+d),parseInt(a.G+e),parseInt(a.B+f));return 0!=g.indexOf("#")&&(g=a),g},Helpers.bw=function(a){if("undefined"==typeof Colors)throw"Requires colors.min.js library";var b,c=Colors.hex2rgb(a).a,d=function(a,b){var c=Math.abs,d=(299*a[0]+587*a[1]+114*a[2])/1e3,e=(299*b[0]+587*b[1]+114*b[2])/1e3,f=Math.round(Math.abs(d-e)),g=c(a[0]-b[0])+c(a[1]-b[1])+c(a[2]-b[2]);return[f,g]},e=[255,255,255],f=[0,0,0];if(c[1]>200&&c[0]+c[2]<50)b=f;else{var g=d(f,c),h=d(e,c);b=4*g[0]+g[1]>4*h[0]+h[1]?f:4*h[0]+h[1]>4*g[0]+g[1]?e:g[0]<h[0]?e:f}return"rgb("+b.join(",")+")"},Helpers.removeMobileAddressBar=function(a){function b(){window.scrollTo(0,0),document.body.style.height="100%",/(iphone|ipod)/.test(navigator.userAgent.toLowerCase())||document.body.parentNode&&(document.body.parentNode.style.height="100%")}a?b():(setTimeout(b,700),setTimeout(b,1500))},Helpers.orientationInfo=function(a,b){a=a||$(window).width(),b=b||$(window).height();var c=a>b?"horizontal":"vertical";return{layout:c,ratio:a/b}},Helpers.dots=function(a){for(var b="",c=0;a>c;c++)c%5==0&&(b+=" "),b+="&#149;";return 0==a&&(b="0"),b},Helpers.isIOS=function(){navigator.userAgent.toLowerCase().match(/(iphone|ipod|ipad)/)},Helpers.exists=function(){for(var a=!0,b=0;b<arguments.length;b++)if("undefined"==typeof arguments[b]){a=!1;break}return a},Helpers.distanceXY=function(a,b){return Math.sqrt((a.x-b.x)*(a.x-b.x)+(a.y-b.y)*(a.y-b.y))},Helpers.isInArray=function(a,b,c){if(!Helpers.exists(a)||!Helpers.exists(b))return!1;Helpers.isArray(a)||(a=[a]),Helpers.isArray(b)||(b=[b]);for(var d=!1,e=0;e<a.length;e++)for(var f=0;f<b.length;f++){var g=a[e],h=b[f];if(c&&"string"==typeof g&&"string"==typeof h){if(g.toLowerCase()==h.toLowerCase()){d=!0;break}}else if(g==h){d=!0;break}}return d},function(a){a.fn.copyEventTo=function(b,c,d){var e=[];return this.each(function(){var a=jQuery._data(this,"events");if("object"==typeof a){var c=a[b];if("object"==typeof c)for(var d=0;d<c.length;d++)e.push(a[b][d].handler)}}),"string"==typeof c?c=a(c):"object"==typeof c&&"string"==typeof c.tagName&&(c=a(c)),d===!0&&c.off(b),c.each(function(){for(var a=0;a<e.length;a++)c.bind(b,e[a])}),this}}(jQuery),function(){if("performance"in window==0&&(window.performance={}),Date.now=Date.now||function(){return(new Date).getTime()},"now"in window.performance==0){var a=Date.now();performance.timing&&performance.timing.navigationStart&&(a=performance.timing.navigationStart),window.performance.now=function(){return Date.now()-a}}}();var Civvies=function(a,b,c,d){function e(a,b,c){return this.version=l+" (version "+i+") - "+j+" by "+k,this.timing_log=[],this.game_options=null,this.times_game_drawn=0,this.initialization_seed=null,this.initialize(a,b,c)}function f(a){a=a||{},a.rand_seed=a.rand_seed||Math.random();var b=3e5*Math.sin(a.rand_seed++);return b-Math.floor(b)}function g(a,b){return a=a||100,parseInt(f(b)*a+1)}function h(a,b,c){var d=a.length,e=g(d,b)-1,f=a[e];return c&&f==c&&(e=(e+1)%d,f=a[e]),f}var i="0.0.1",j="HTML game engine to simulate civilization or city building.",k="Jay Crossler - http://github.com/jaycrossler",l="civvies.js",m={},n={};return e.prototype.initialize=function(a,b,c){return"get_private_functions"==a?this._private_functions:void(""==a||this.drawOrRedraw(a,b,c))},e.prototype.data=m,e.prototype.initializeOptions=function(a,b){"game_options"==a&&(n=b)},e.prototype.drawOrRedraw=function(b){var c=window.performance.now(),d=this;null===d.game_options&&(d.initialization_seed=null),d.initialization_options=b||d.initialization_options||{},d.game_options=a.extend({},d.game_options||n,b||{}),b=b||{};var e=b.rand_seed||d.initialization_seed||Math.floor(1e5*Math.random());d.initialization_seed=e,d.initialization_options.rand_seed=e,d.randomSetSeed(e),!d.data.gui_drawn&&d._private_functions.buildInitialDisplay&&(d.data.gui_drawn=!0,d._private_functions.buildInitialData(d),d._private_functions.buildInitialDisplay(d)),d.start(b);var f=window.performance.now(),g=f-c;d.timing_log.push({name:"build-elapsed",elapsed:g,times_redrawn:d.times_game_drawn})},e.prototype.log=function(a,d){var e="Civvies: [seed:"+this.game_options.rand_seed+" #"+this.times_game_drawn+"]";return b.each(this.timing_log,function(a){e+="exception"==a.name?a.ex&&a.ex.name?"\n -- EXCEPTION: "+a.ex.name+", "+a.ex.message:a.msg?"\n -- EXCEPTION: "+a.msg:"\n -- EXCEPTION":a.elapsed?"\n - "+a.name+": "+c.round(a.elapsed,4)+"ms":"\n - "+a.name}),a&&console.log(e),d&&(e=e.replace(/\n/g,"<br/>")),e},e.prototype.logMessage=function(a,c){b.isString(a)&&(a={name:a}),this.timing_log.push(a),c&&console.log(a),this._private_functions.log_display&&this._private_functions.log_display(this)},e.prototype.lastTimeDrawn=function(){var a=0,c=b.last(this.timing_log);return c&&(a=c.elapsed),a},e.prototype.getSeed=function(a){var b=this.initialization_options||{};return a?JSON.stringify(b):b},e.prototype.start=function(a){if(!this._private_functions.start_game_loop)throw"Game loop not found";this._private_functions.start_game_loop(this,a)},e.prototype.stop=function(){this._private_functions.stop_game_loop&&this._private_functions.stop_game_loop(this)},e.prototype.randomSetSeed=function(a){this.game_options=this.game_options||{},this.game_options.rand_seed=a||Math.random()},e.prototype._private_functions={random:f,randInt:g,randOption:h},e}($,_,Helpers,maths);Civvies.initializeOptions=function(a,b){var c=new Civvies("");c.initializeOptions(a,b)},function(a){function b(a){$("<h3>").text("Resources").appendTo(o.basic_resources);var b=$("<table>").appendTo(o.basic_resources);_.each(a.game_options.resources,function(c){if(1==c.grouping){var d=_.str.titleize(c.title||c.name),e=$("<tr>").appendTo(b),f=$("<td>").appendTo(e),g=c.amount_from_click||1,h=1==g?d:g+" "+Helpers.pluralize(d),i=r.cost_benefits_text(a,c,!0,g),j=r.getResourceMax(a,c);$("<button>").text("Gather "+d).popover({title:"Manually Gather "+h,content:i,trigger:"hover",placement:"bottom",html:!0}).on("click",function(){r.increment_from_click(a,c)}).appendTo(f),$("<td>").text(d+":").appendTo(e),c.$holder=$("<td>").addClass("number").attr("id","resource-"+c.name).text(0).appendTo(e);var k=$("<td>").addClass("icon").appendTo(e);$("<img>").attr("src",c.image).addClass("icon icon-lg").appendTo(k),c.$max=$("<td>").addClass("number_small").attr("id","resource-max-"+c.name).text("(Max: "+j+")").appendTo(e),c.$rate=$("<td>").addClass("number net").attr("id","resource-rate-"+c.name).text("0/s").appendTo(e)}})}function c(a){$("<h3>").text("Special Resources").appendTo(o.secondary_resources),_.each(a.game_options.resources,function(b){if(2==b.grouping){var c=_.str.titleize(b.title||b.name),d=r.cost_benefits_text(a,b,!1,1),e=r.getResourceMax(a,b),f=$("<div>").addClass("icon resource-holder").appendTo(o.secondary_resources);$("<span>").text(c+":").css({verticalAlign:"top"}).appendTo(f);var g=$("<span>").css({display:"inline-block"}).appendTo(f);b.$holder=$("<span>").attr("id","resource-"+b.name).addClass("number").text(0).appendTo(g),b.$max=$("<span>").attr("id","resource-max-"+b.name).addClass("number_small").text("(Max: "+e+")").appendTo(g),$("<img>").attr("src",b.image).css({verticalAlign:"top"}).popover({title:c,content:d,trigger:"hover",placement:"right",html:!1,container:f}).addClass("icon icon-lg").appendTo(f)}})}function d(a){var b=r.calculate_increment_costs(a);_.each(a.game_options.resources,function(c){if(c.$holder){var d=a.data.resources[c.name];d=Helpers.abbreviateNumber(d,!1,!0),c.$holder.text(d)}if(c.$max){var e=r.getResourceMax(a,c);e=Helpers.abbreviateNumber(e),c.$max.text("(Max: "+e+")")}if(c.$rate){var f,g=Helpers.abbreviateNumber(b[c.name])||0;f=0>g?'<span style="color:red">'+g+"/s":g>0?'<span style="color:green">+'+g+"/s":g+"/s",c.$rate.html(f)}}),_.each(a.game_options.buildings,function(b){if(b.$holder){var c=a.data.buildings[b.name];c=Helpers.abbreviateNumber(c),b.$holder.text(c)}})}function e(a){$("<h3>").text("Buildings").appendTo(o.building_list);var b=$("<table>").appendTo(o.building_list),c=a.game_options.buildings[0].type;_.each(a.game_options.buildings,function(d){var e=_.str.titleize(d.title||d.name),f=a.data.buildings[d.name];d.type!=c&&$("<tr>").css({height:"6px"}).appendTo(b),c=d.type;var g=$("<tr>").appendTo(b);f||g.hide();var h=$("<td>").appendTo(g);_.each(p,function(b){var c=b>1?"x"+b:"Build "+e,f=b>1?"x"+b:"",g=1==b?e:b+" "+Helpers.pluralize(e),i=r.cost_benefits_text(a,d,!0,b);d["$btn_x"+b]=$("<button>").text(c).popover({title:"Build "+g,content:i,trigger:"hover",placement:"top",html:!0}).prop({disabled:!0}).addClass(f).on("click",function(){r.create_building(a,d,b)}).appendTo(h)}),$("<td>").text(Helpers.pluralize(e)+": ").appendTo(g),d.$holder=$("<td>").addClass("number").attr("id","building-"+d.name).text(f).appendTo(g),d.$display=g})}function f(a){var b=!1;_.each(a.game_options.buildings,function(c){var d,e=r.building_is_purchasable(a,c,1);!c.shown_before&&e&&(c.shown_before=!0,c.$display.css({display:"block"})),c.shown_before&&(b=!0,d=e,_.each(p,function(b){d=r.building_is_purchasable(a,c,b);var e=c["$btn_x"+b],f=e.prop("disabled");f||d||e.popover("hide"),e.prop({disabled:!d})}))})}function g(a){$("<h3>").text("Population").appendTo(o.population_info);var b=r.population(a),c=b.current,d=b.max,e=$("<div>").appendTo(o.population_info);$("<span>").text("Current Population: ").appendTo(e),o.population_current=$("<span>").text(c).appendTo(e);var f=$("<div>").appendTo(o.population_info);$("<span>").text("Maximum Population: ").appendTo(f),o.population_max=$("<span>").text(d).appendTo(f);var g=$("<div>").appendTo(o.population_info);_.each(p,function(b){var c=$("<div>").appendTo(g),d=b>1?"Create "+b+" workers":"Create worker",e=r.worker_food_cost(a,b),f="Consume "+e+" food";o["create_workers_x"+b]=$("<button>").text(d).prop({disabled:!0}).on("click",function(){r.create_workers(a,b),r.redraw_data(a)}).appendTo(c),o["create_workers_x"+b+"_cost"]=$("<span>").text(f).appendTo(c)})}function h(a){var b=r.population(a),c=b.current,d=b.max;o.population_current.text(c),o.population_max.text(d),_.each(p,function(b){var c=r.worker_food_cost(a,b),d="Consume "+c+" food";o["create_workers_x"+b].prop({disabled:!r.workers_are_creatable(a,b)}),o["create_workers_x"+b+"_cost"].text(d)})}function i(a){$("<h3>").text("Jobs").hide().appendTo(o.jobs_list);var b=$("<table>").appendTo(o.jobs_list),c=a.game_options.populations[0].type;_.each(a.game_options.populations,function(d){var e=_.str.titleize(d.title||d.name),f=a.data.populations[d.name];d.type!=c&&$("<tr>").css({height:"6px"}).appendTo(b),c=d.type;var g=$("<tr>").appendTo(b);f||g.hide();var h=$("<td>").appendTo(g);_.each(q,function(b){var c,g=!1,i=!1;_.isNumber(b)?(c=b>0?"+"+b:b,d.unassignable||(g=!0,i=!0)):"info"==b?(c=e+": ",i=!0):(c=b,g=!0,d.unassignable||(i=!0));var j=_.isString(b)?e:b+" "+Helpers.pluralize(e),k=r.cost_benefits_text(a,d,!0,b);if(i)if(g)d["$btn_x"+b]=$("<button>").text(c).popover({title:"Assign "+j,content:k,trigger:"hover",placement:"bottom",html:!0}).prop({disabled:!0}).addClass("multiplier").on("click",function(){r.assign_workers(a,d,b),r.redraw_data(a)}).appendTo(h);else{var l=$("<div>").addClass("multiplier_holder").popover({title:j,content:k,trigger:"hover",placement:"bottom",html:!0}).appendTo(h);$("<span>").text(c).appendTo(l),d.$holder=$("<span>").addClass("number").attr("id","job-"+d.name).text(f).appendTo(l)}}),d.$display=g})}function j(a){var b=!1;_.each(a.game_options.populations,function(c){var d,e=a.data.populations[c.name],f=r.population_is_assignable(a,c,1);c.shown_before||!f&&!e||(c.shown_before=!0,c.$display.css({display:"block"})),c.shown_before&&(b=!0,d=f,c.$holder.text(e),_.each(q,function(b){d=r.population_is_assignable(a,c,b);var e=c["$btn_x"+b];if(e){var f=e.prop("disabled");f||d||e.popover("hide"),e.prop({disabled:!d})}}))}),b&&o.jobs_list.find("h3").show()}function k(a){o.upgrade_available=$("<h3>").text("Available Upgrades").appendTo(o.upgrade_list),$("<div>").appendTo(o.upgrade_available),o.upgrade_available_alt=$("<h3>").text("No upgrades currently purchasable").hide().appendTo(o.upgrade_list),o.upgrades_researched=$("<h3>").text("Researched Upgrades").appendTo(o.upgrade_list),$("<div>").appendTo(o.upgrades_researched),o.upgrade_researched_alt=$("<h3>").text("No upgrades purchased").hide().appendTo(o.upgrade_list);var b,c="",d=0,e=0,f=_.filter(a.game_options.upgrades,function(a){return"deity"!=a.type});_.each(f,function(f){var g=_.str.titleize(f.title||f.name),h=a.data.upgrades[f.name],i=r.can_purchase_upgrade(a,f),j="Upgrade: "+g,k=r.cost_benefits_text(a,f,!0);f.type!=c&&(b=$("<div>").css({fontSize:"9px"}).hide().text(_.str.titleize(f.type)+":").appendTo(o.upgrade_available)),c=f.type;var l=!1;f.shown_before?l=!h:i&&(l=!h,f.shown_before=!0),l&&(b.show(),d++),h&&e++,f.$holder_category=b,f.$holder=$("<button>").text(g).css({display:l?"inline-block":"none"}).prop({disabled:!i}).popover({title:j,content:k,trigger:"hover",placement:"top",html:!0}).on("click",function(){f.$holder.popover("hide"),r.purchase_upgrade(a,f),r.redraw_data(a)}).addClass("icon upgrade_holder").appendTo(o.upgrade_available),f.$holder_purchased=$("<div>").text(g).css({backgroundColor:"lightgreen",display:h?"inline-block":"none"}).popover({title:"Purchased "+j,content:k,trigger:"hover",placement:"top",html:!0}).addClass("icon upgrade_holder").appendTo(o.upgrades_researched)}),d>0?(o.upgrade_available.show(),o.upgrade_available_alt.hide()):(o.upgrade_available.hide(),o.upgrade_available_alt.show()),e>0?(o.upgrades_researched.show(),o.upgrade_researched_alt.hide()):(o.upgrades_researched.hide(),o.upgrade_researched_alt.show())}function l(a){var b=_.filter(a.game_options.upgrades,function(a){return"deity"!=a.type}),c=0,d="",e=0,f=0;_.each(b,function(b){var g=a.data.upgrades[b.name],h=r.can_purchase_upgrade(a,b),i=!1;b.shown_before?i=!g:h&&(i=!g,b.shown_before=!0),i&&(b.$holder_category.show(),c++,e++),g&&f++,b.$holder.css({display:i?"inline-block":"none"}).prop({disabled:!h}),b.$holder_purchased.css({display:g?"inline-block":"none"}),b.type!=d&&(0==c&&b.$holder_category.hide(),c=0),d=b.type}),e>0?(o.upgrade_available.show(),o.upgrade_available_alt.hide()):(o.upgrade_available.hide(),o.upgrade_available_alt.show()),f>0?(o.upgrades_researched.show(),o.upgrade_researched_alt.hide()):(o.upgrades_researched.hide(),o.upgrade_researched_alt.show())}function m(a){$("<h3>").text("Achievements").appendTo(o.achievements_list),$("<div>").appendTo(o.achievements_list),_.each(a.game_options.achievements,function(b){var c=a.data.achievements[b.name],d=c?"#aaf":"#faa",e=_.str.titleize(b.title||b.name),f=e+"<br/>"+(b.notes||"");f+=c?"<br/>You have this achievement":"<br/>You have not achieved this yet",b.$holder=$("<div>").text(e).css({backgroundColor:d,display:"inline-block"}).popover({title:"Achievement",content:f,trigger:"hover",placement:"top",html:!0}).addClass("achievement_holder").appendTo(o.achievements_list)})}function n(a){_.each(a.game_options.achievements,function(b){var c=a.data.achievements[b.name],d=c?"#aaf":"#faa",e=_.str.titleize(b.title||b.name),f=e+"<br/>"+(b.notes||"");f+=c?"<br/>You have this achievement":"<br/>You have not achieved this yet",b.$holder.popover({title:"Achievement",content:f,trigger:"hover",placement:"top",html:!0}).css({backgroundColor:d,display:"inline-block"})})}var o={},p=[1,10,100,1e3],q=["-all",-100,-10,-1,"info",1,10,100,"+max"],r=new a("get_private_functions");r.buildInitialDisplay=function(a){o.basic_resources=$("#basic_resources"),b(a),o.secondary_resources=$("#secondary_resources"),c(a),o.building_list=$("#buildingsPane"),e(a),o.population_info=$("#populationContainer"),g(a),o.jobs_list=$("#jobsContainer"),i(a),o.logs=$("#eventsContainer"),o.upgrade_list=$("#upgradesPane"),k(a),o.achievements_list=$("#achievementsList"),m(a)},r.redraw_data=function(a){d(a),f(a),h(a),j(a),l(a),n(a)},r.log_display=function(a){if(o.logs){var b="<b>Civvies: [seed:"+a.game_options.rand_seed+"]</b>",c=_.last(a.timing_log,5);_.each(c.reverse(),function(a){b+="exception"==a.name?a.ex&&a.ex.name?"<br/> -- EXCEPTION: "+a.ex.name+", "+a.ex.message:a.msg?"<br/> -- EXCEPTION: "+a.msg:"<br/> -- EXCEPTION":a.elapsed?"<br/> - "+a.name+": "+Helpers.round(a.elapsed,4)+"ms":"<br/> - "+a.name}),o.logs.html(b)}},r.updateBuildingTotals=function(){},r.updateSpawnButtons=function(){},r.updateJobs=function(){},r.updateJobButtons=function(){},r.updateUpgrades=function(){},r.updateDeity=function(){},r.updateOldDeities=function(){},r.updateMobs=function(){},r.updateDevotion=function(){},r.updateRequirements=function(){},r.updateAchievements=function(){},r.updateParty=function(){},r.updatePartyButtons=function(){},r.updateTargets=function(){},r.updateHappiness=function(){},r.updateWonder=function(){},r.updateWonderList=function(){},r.updateReset=function(){},r.paneSelect=function(){},r.toggleCustomIncrements=function(){},r.toggleNotes=function(){},r.impExp=function(){},r.tips=function(){},r.versionAlert=function(){},r.text=function(){},r.textShadow=function(){},r.iconToggle=function(){},r.prettify=function(){},r.toggleDelimiters=function(){},r.toggleWorksafe=function(){},r.gameLog=function(){}}(Civvies),function(a){var b=new a("get_private_functions");b.increment_from_click=function(a,c){b.increment_resource(a,c,c.amount_from_click||1),b.redraw_data(a)},b.buildInitialData=function(a){a.data=a.data||{},a.data.resources=a.data.resources||{},_.each(a.game_options.resources,function(b){a.data.resources[b.name]=b.initial||0}),a.data.buildings=a.data.buildings||{},_.each(a.game_options.buildings,function(b){a.data.buildings[b.name]=b.initial||0}),a.data.populations=a.data.populations||{},_.each(a.game_options.populations,function(b){a.data.populations[b.name]=b.initial||0}),a.data.variables=a.data.variables||{},_.each(a.game_options.variables,function(b){a.data.variables[b.name]=b.value||0}),a.data.upgrades=a.data.upgrades||{},
_.each(a.game_options.upgrades,function(b){a.data.upgrades[b.name]=b.initial||!1}),a.data.achievements=a.data.achievements||{},_.each(a.game_options.achievements,function(b){a.data.achievements[b.name]=b.initial||!1})},b.info=function(a,b,c,d,e){var f=_.find(a.game_options[b],function(a){return a.name==c});return f&&d&&(f=f[d]),f||(f=e),f},b.variable=function(a,b){return a.data.variables[b]},b.getResourceMax=function(a,c){var d=b.variable(a,"storageInitial");return _.each(a.game_options.buildings,function(b){if(b.supports&&b.supports[c.name]){var e=a.data.buildings[b.name];d+=e*b.supports[c.name]}}),d},b.cost_benefits_text=function(a,b,c,d){d=d||1,_.isNumber(d)||(d=1);var e,f,g,h=[],i=[],j=[],k=[],l=[];for(e in b.costs||{})f=b.costs[e],_.isString(f)&&(f=a.data.variables[f]),f*=d,g=Helpers.abbreviateNumber(f)+" ",g+=1==f?e:Helpers.pluralize(e),c&&(g="<span class='cost_text'>"+g+"</span>"),h.push(g);for(e in b.consumes||{})f=b.consumes[e],_.isString(f)&&(f=a.data.variables[f]),f*=d,g=Helpers.abbreviateNumber(f)+" ",g+=1==f?e:Helpers.pluralize(e),c&&(g="<span class='cost_text'>"+g+"</span>"),i.push(g);for(e in b.benefits||{})f=b.benefits[e],_.isString(f)&&(f=a.data.variables[f]),f*=d,g=Helpers.abbreviateNumber(f)+" ",g+=1==f?e:Helpers.pluralize(e),c&&(g="<span class='benefit_text'>"+g+"</span>"),j.push(g);for(e in b.produces||{})f=b.produces[e],_.isString(f)&&(f=a.data.variables[f]),f*=d,g=Helpers.abbreviateNumber(f)+" ",g+=1==f?e:Helpers.pluralize(e),c&&(g="<span class='benefit_text'>"+g+"</span>"),l.push(g);for(e in b.supports||{})f=b.supports[e],_.isString(f)&&(f=a.data.variables[f]),f*=d,g=Helpers.abbreviateNumber(f)+" ",g+=1==f?e:Helpers.pluralize(e),c&&(g="<span class='benefit_text'>"+g+"</span>"),k.push(g);b.population_supports&&(g=1==f?"houses 1 person":"houses "+Helpers.abbreviateNumber(b.population_supports*d)+" people",c&&(g="<span class='benefit_population_text'>"+g+"</span>"),j.push(g));var m;b.notes&&(m=b.notes,c&&(m="<span class='notes_text'>"+m+"</span>"));var n;b.amount_from_click&&(n="Gather "+b.amount_from_click+" "+Helpers.pluralize(b.name),c&&(n="<span class='benefit_text'>"+n+"</span>"));var o=[];_.each(b.chances||[],function(a){g="",a.resource&&(g="Chance to find "+a.resource),c&&(g="<span class='notes_text'>"+g+"</span>"),o.push(g)});var p;b.type&&(p=_.str.titleize(b.type),p=c?"<b>Type: <span class='notes_text'>"+p+"</span></b>":"Type: "+p);var q=[];p&&q.push(p),n&&q.push(n),h.length&&q.push("Costs: "+h.join(", ")),i.length&&q.push("Consumes: "+i.join(", ")),j.length&&q.push("Benefits: "+j.join(", ")),l.length&&q.push("Produces: "+l.join(", ")),o.length&&q.push(o.join(", ")),k.length&&q.push("Supports: "+k.join(", ")),m&&q.push("Notes: "+m);var r=c?".</br>":".  ";return q.join(r)||""},b.create_building=function(a,c,d){if(d=d||1,b.building_is_purchasable(a,c,d)){var e=c.costs||{};for(var f in e)a.data.resources[f]-=d*e[f];a.data.buildings[c.name]+=d,b.redraw_data(a),a.logMessage("Purchased: "+d+"x "+c.name,!0)}else console.error("Can't purchase building: "+d+"x "+c.name)},b.building_is_purchasable=function(a,b,c){c=c||1;var d=b.costs||{},e=b.upgrades||{},f=!0;for(var g in d){var h=a.data.resources[g];if(h<c*d[g]){f=!1;break}}if(f)for(var i in e){var j=a.data.upgrades[i];if(!j){f=!1;break}}return f},b.test=function(a){b.increment_resource(a,b.info(a,"resources","food"),1e3),b.increment_resource(a,b.info(a,"resources","wood"),1e3),b.increment_resource(a,b.info(a,"resources","stone"),1e3),b.increment_resource(a,b.info(a,"resources","herbs"),10),b.increment_resource(a,b.info(a,"resources","skins"),10),b.increment_resource(a,b.info(a,"resources","ore"),10),b.increment_resource(a,b.info(a,"resources","leather"),10),b.increment_resource(a,b.info(a,"resources","metal"),10),b.redraw_data(a)},b.test2=function(a){b.test(a),b.create_building(a,b.info(a,"buildings","woodstock"),1),b.test(a),b.create_building(a,b.info(a,"buildings","woodstock"),2),b.test(a),b.create_building(a,b.info(a,"buildings","woodstock"),4),b.test(a),b.create_building(a,b.info(a,"buildings","woodstock"),2),b.create_building(a,b.info(a,"buildings","stonestock"),2),b.create_building(a,b.info(a,"buildings","barn"),2),b.create_building(a,b.info(a,"buildings","hut"),10),b.test(a),b.create_building(a,b.info(a,"buildings","woodstock"),3),b.create_building(a,b.info(a,"buildings","stonestock"),3),b.create_building(a,b.info(a,"buildings","barn"),3),b.test(a),b.redraw_data(a)},b.increment_resource=function(a,c,d){var e=b.getResourceMax(a,c);a.data.resources[c.name]=maths.clamp(a.data.resources[c.name]+d,0,e),c.chances&&_.each(c.chances||[],function(c){var e=c.chance||.01;_.isString(e)&&(e=a.data.variables[e]),_.isNumber(e)&&b.random(a.game_options)<e&&c.resource&&(a.data.resources[c.resource]+=d)})},b.population=function(a){var c={current:0,max:0,current_that_eats:0},d=0,e=0;for(var f in a.data.populations)d+=a.data.populations[f],b.info(a,"populations",f,"doesnt_consume_food",!1)||(e+=a.data.populations[f]);c.current=d,c.current_that_eats=e;var g=0;return _.each(a.game_options.buildings,function(b){if(b.population_supports){var c=a.data.buildings[b.name];g+=c*b.population_supports}}),c.max=g,c},b.worker_food_cost=function(a,c){var d=b.info(a,"variables","foodCostInitial","value",20);c=c||1;var e=b.population(a),f=d+Math.floor((e.current+c)/100);return f*c},b.create_workers=function(a,c){b.workers_are_creatable(a,c)&&(a.data.resources.food-=b.worker_food_cost(a,c),a.data.populations.unemployed+=c,a.logMessage("Purchased: "+c+"x unemployed workers",!0))},b.workers_are_creatable=function(a,c){var d=b.worker_food_cost(a,c)<=a.data.resources.food,e=!1;if(d){var f=b.population(a);e=f.current+c<=f.max}return d&&e},b.population_is_assignable=function(a,b,c){c=c||1;var d=!1;if(!b.unassignable){var e=a.data.populations[b.name];if(_.isNumber(c))if(c>0){var f=a.data.populations.unemployed;f>=c&&(d=!0)}else e+c>=0&&(d=!0);if(d&&!b.doesnt_require_office){var g=0;_.each(a.game_options.buildings,function(c){if(c.supports){var d=c.supports[b.name];d&&(g+=a.data.buildings[c.name]*d)}}),d=g>=e+c}if(d&&b.upgrades)for(var h in b.upgrades){var i=a.data.upgrades[h];if(!i){d=!1;break}}}return d},b.assign_workers=function(a,c,d){b.population_is_assignable(a,c,d)&&_.isNumber(d)&&(a.data.populations[c.name]+=d,a.data.populations.unemployed-=d)},b.can_purchase_upgrade=function(a,b){var c=b.costs,d=!0;for(var e in c){var f=a.data.resources[e];if(f<c[e]){d=!1;break}}if(d)for(var g in b.upgrades)if(!a.data.upgrades[g]){d=!1;break}return d},b.purchase_upgrade=function(a,c){if(b.can_purchase_upgrade(a,c)){var d=c.costs;for(var e in d){var f=d[e];b.increment_resource(a,b.info(a,"resources",e),-f)}a.data.upgrades[c.name]=!0}},b.calculate_increment_costs=function(a){var c={};return _.each(a.game_options.resources,function(d){if(1==d.grouping){var e=0;if(_.each(a.game_options.populations,function(b){var c=a.data.populations[b.name];if(c&&b.produces&&b.produces[d.name]){var f=b.produces[d.name];_.isString(f)&&(f=a.data.variables[f]),e+=f*c}if(c&&b.consumes&&b.consumes[d.name]){var g=b.consumes[d.name];_.isString(g)&&(g=a.data.variables[g]),e-=g*c}}),"food"==d.name){var f=b.population(a);e-=f.current_that_eats}c[d.name]=e}}),c},b.increment=function(){},b.createBuilding=function(){},b.buildCustom=function(){},b.calcCost=function(){},b.spawn=function(){},b.spawnCustom=function(){},b.jobCull=function(){},b.hire=function(){},b.hireAll=function(){},b.fire=function(){},b.fireAll=function(){},b.fireCustom=function(){},b.hireCustom=function(){},b.raiseDead=function(){},b.shade=function(){},b.upgrade=function(){},b.digGraves=function(){},b.randomWorker=function(){},b.wickerman=function(){},b.walk=function(){},b.pestControl=function(){},b.plague=function(){},b.spawnMob=function(){},b.smite=function(){},b.party=function(){},b.partyCustom=function(){},b.invade=function(){},b.plunder=function(){},b.glory=function(){},b.grace=function(){},b.mood=function(){},b.startWonder=function(){},b.renameWonder=function(){},b.wonderBonus=function(){},b.updateWonderLimited=function(){},b.tradeTimer=function(){},b.trade=function(){},b.buy=function(){},b.speedWonder=function(){}}(Civvies),function(a){function b(a){for(var b in a.data.populations){var c=a.data.populations[b];if(c){var e,f=d.info(a,"populations",b),g=f.consumes,h=f.produces,i=c;if(g){var j=c;for(e in g){var k=d.info(a,"resources",e),l=g[e];_.isString(l)&&(l=a.data.variables[l]),d.increment_resource(a,k,j*-l)}i=j}if(h&&i)for(e in h){var m=d.info(a,"resources",e),n=h[e];_.isString(n)&&(n=a.data.variables[n]),d.increment_resource(a,m,i*n)}}}}function c(a){var b=d.population(a);if(b.current<=a.data.resources.food)a.data.resources.food-=b.current_that_eats;else{if(a.data.populations.unemployed)return a.logMessage("Not enough food, assigned "+a.data.populations.unemployed+" vagrants to farms",!0),void d.assign_workers(a,d.info(a,"populations","farmers"),a.data.populations.unemployed);a.data.resources.food*=.2;var c=b.current_that_eats-a.data.resources.food-a.data.populations.farmers+.5;if(c=Math.round(c),0>c)return;a.logMessage("Not enough food, need to cull the population: "+c,!0);for(var e=a.game_options.populations.sort(function(a,b){var c=a.cull_order||(a.doesnt_consume_food?15:5),d=b.cull_order||(b.doesnt_consume_food?15:5);return c-d}),f=0;f<e.length;f++)if(c>0&&!e[f].doesnt_consume_food){var g=e[f].name,h=a.data.populations[g];h>=c?(a.data.populations[g]-=c,c=0):(c-=a.data.populations[g],a.data.populations[g]=0)}}}var d=new a("get_private_functions"),e=null;d.start_game_loop=function(a,b){b=b||{},d.stop_game_loop(a),a.logMessage("Game Loop Starting"),e=setInterval(function(){d.tick_interval(a)},b.tick_time||1e3)},d.stop_game_loop=function(a){e&&(clearInterval(e),a.logMessage("Game Loop Stopped"))},d.tick_interval=function(a){d.autosave_if_time(a),c(a),b(a),d.redraw_data(a)}}(Civvies),function(a){var b=new a("get_private_functions");b.autosave_if_time=function(a){a.game_options.autosave&&(a.data.autosave_counter=a.data.autosave_counter||0,a.data.autosave_counter+=1,a.data.autosave_counter>=a.game_options.autosave_every&&(b.save(a,"auto"),a.data.autosave_counter=0))},b.load=function(a,b){},b.save=function(a,b){console.log("Autosave")},b.toggleAutosave=function(a,b){},b.deleteSave=function(a,b){},b.renameCiv=function(a){},b.renameRuler=function(a){},b.renameDeity=function(a){},b.reset=function(a){}}(Civvies),function(a){var b={rand_seed:0,tick_time:1e3,autosave_every:60,autosave:!0,resources:[{name:"food",grouping:1,image:"../images/civclicker/food.png",chances:[{chance:"foodSpecialChance",resource:"herbs"}],amount_from_click:1},{name:"wood",grouping:1,image:"../images/civclicker/wood.png",chances:[{chance:"woodSpecialChance",resource:"skins"}],amount_from_click:1},{name:"stone",grouping:1,image:"../images/civclicker/stone.png",chances:[{chance:"stoneSpecialChance",resource:"ore"}],amount_from_click:1},{name:"herbs",grouping:2,image:"../images/civclicker/herbs.png",notes:"Found sometimes when gathering food or by farmers"},{name:"skins",grouping:2,image:"../images/civclicker/skins.png",notes:"Found sometimes when collecting wood or by woodcutters"},{name:"ore",grouping:2,image:"../images/civclicker/ore.png",notes:"Found sometimes when mining ore or by miners"},{name:"leather",grouping:2,image:"../images/civclicker/leather.png",notes:"Created by Tanners working in a Tannery"},{name:"metal",grouping:2,image:"../images/civclicker/metal.png",notes:"Created by Blacksmiths working in a Smithy"},{name:"gold",grouping:2,image:"../images/civclicker/gold.png",notes:"Created from trading goods with Traders"},{name:"piety",grouping:2,image:"../images/civclicker/piety.png",notes:"Created by Clerics working in a Temple"},{name:"corpses",grouping:2,image:"../images/civclicker/piety.png",notes:"Created when towns people die from starvation or fighting"},{name:"healing",grouping:3,image:"../images/civclicker/piety.png",notes:"Created by Clerics and Apothecaries"},{name:"wonder",grouping:3,image:"../images/civclicker/piety.png",notes:"Created by Labourers working on a Wonder"}],buildings:[{name:"cave",type:"home",costs:{wood:2,food:1,stone:1},population_supports:1,initial:1},{name:"tent",type:"home",costs:{skins:2,wood:2},population_supports:2},{name:"hovel",type:"home",costs:{food:15,wood:20,stone:5},population_supports:3},{name:"hut",type:"home",costs:{skins:1,wood:20},population_supports:4},{name:"cottage",type:"home",costs:{stone:30,wood:10},population_supports:6,upgrades:{harvesting:!0}},{name:"house",type:"home",costs:{stone:70,wood:30},population_supports:10,upgrades:{masonry:!0}},{name:"mansion",type:"home",costs:{stone:200,wood:200,leather:20},population_supports:20,upgrades:{architecture:!0}},{name:"barn",type:"storage",costs:{wood:100},supports:{food:100,herbs:1e3},upgrades:{harvesting:!0},notes:"Increase the food you can store"},{name:"woodstock",type:"storage",costs:{wood:100},supports:{wood:100,skins:1e3,leather:100},notes:"Increase the wood you can store"},{name:"stonestock",type:"storage",costs:{wood:100},supports:{stone:100,ore:1e3,metal:100},upgrades:{prospecting:!0},notes:"Increase the stone you can store"},{name:"tannery",type:"business",costs:{wood:30,stone:70,skins:2},supports:{tanners:2},upgrades:{skinning:!0}},{name:"smithy",type:"business",costs:{wood:30,stone:70,ore:2},supports:{blacksmiths:2},upgrades:{prospecting:!0}},{name:"apothecary",type:"business",costs:{wood:30,stone:70,herbs:2},supports:{apothecaries:2},upgrades:{harvesting:!0}},{name:"temple",type:"business",costs:{wood:30,stone:120,herbs:10},supports:{clerics:1,piety:2e3,gold:5},upgrades:{masonry:!0}},{name:"barracks",type:"business",costs:{food:20,wood:60,stone:120},supports:{soldiers:5,gold:2},upgrades:{weaponry:!0,masonry:!0}},{name:"stable",type:"business",costs:{food:60,wood:60,stone:120,leather:10},supports:{cavalry:5},upgrades:{horseback:!0}},{name:"mill",type:"upgrade",costs:{wood:100,stone:100},options:{food_efficiency:.1},upgrades:{wheel:!0},notes:"Improves Farming Efficiency"},{name:"graveyard",type:"upgrade",costs:{wood:50,stone:200,herbs:50},options:{grave_spot:100},notes:"Increases Grave Plots",upgrades:{writing:!0}},{name:"fortification",type:"upgrade",costs:{stone:100},options:{defense_improvement:5},supports:{gold:10},notes:"Improves Defenses",upgrades:{codeoflaws:!0,palisade:!0}},{name:"battleAltar",title:"Battle Altar",type:"altar",costs:{devotion:1,stone:200,metal:50,piety:200},upgrades:{deity:!0}},{name:"fieldsAltar",title:"Fields Altar",type:"altar",costs:{devotion:1,food:500,wood:500,stone:200,piety:200},upgrades:{deity:!0}},{name:"underworldAltar",title:"Underworld Altar",type:"altar",costs:{devotion:1,stone:200,piety:200,corpses:1},upgrades:{deity:!0}},{name:"catAltar",title:"Cat Altar",type:"altar",costs:{devotion:1,herbs:100,stone:200,piety:200},upgrades:{deity:!0}}],populations:[{name:"unemployed",title:"Unemployed Worker",type:"basic",notes:"Unassigned Workers that eat up food",unassignable:!0,cull_order:2},{name:"sick",type:"basic",notes:"Sick workers that need medical help",unassignable:!0,cull_order:1},{name:"farmers",type:"basic",produces:{food:"farmers"},doesnt_require_office:!0,cull_order:10},{name:"woodcutters",type:"basic",produces:{wood:"woodcutters"},doesnt_require_office:!0,cull_order:9},{name:"miners",type:"basic",produces:{stone:"miners"},doesnt_require_office:!0},{name:"tanners",type:"medieval",consumes:{skins:1},produces:{leather:"tanners"}},{name:"blacksmiths",type:"medieval",consumes:{ore:1},produces:{metal:"blacksmiths"}},{name:"apothecaries",type:"medieval",consumes:{herbs:1},supports:{healing:"apothecaries"}},{name:"clerics",type:"medieval",consumes:{food:2,herbs:1},supports:{healing:.1,burying:5},produces:{piety:"clerics"},cull_order:6},{name:"labourers",type:"medieval",consumes:{herbs:10,leather:10,metal:10,piety:10},produces:{wonder:1},cull_order:2},{name:"cats",type:"mystical",cull_order:11},{name:"zombies",type:"mystical",costs:{corpses:1},doesnt_consume_food:!0},{name:"soldiers",type:"warfare",consumes:{food:2},supports:{battle:"soldiers"},upgrades:{weaponry:!0},cull_order:8},{name:"cavalry",type:"warfare",consumes:{food:1,herbs:1},supports:{battle:"cavalry"},upgrades:{horseback:!0},cull_order:7},{name:"siege",type:"warfare",costs:{metal:10,wood:100},supports:{battle:.1},upgrades:{construction:!0,mathematics:!0},doesnt_require_office:!0,doesnt_consume_food:!0}],variables:[{name:"storageInitial",value:120},{name:"happiness",value:1},{name:"farmers",value:1.2},{name:"pestBonus",value:0},{name:"woodcutters",value:.5},{name:"miners",value:.2},{name:"tanners",value:.5},{name:"blacksmiths",value:.5},{name:"apothecaries",value:.1},{name:"clerics",value:.05},{name:"soldiers",value:.05},{name:"cavalry",value:.08},{name:"foodSpecialChance",value:.02},{name:"woodSpecialChance",value:.02},{name:"stoneSpecialChance",value:.01},{name:"foodCostInitial",value:20}],upgrades:[{name:"skinning",type:"stone age",costs:{skins:10}},{name:"harvesting",type:"stone age",costs:{herbs:10}},{name:"prospecting",type:"stone age",costs:{ore:10}},{name:"butchering",type:"farming",costs:{leather:40},upgrades:{skinning:!0}},{name:"gardening",type:"farming",costs:{herbs:40},upgrades:{harvesting:!0}},{name:"extraction",type:"farming",title:"Metal Extraction",costs:{metal:40},upgrades:{prospecting:!0}},{name:"domestication",type:"basic farming",costs:{leather:20},variable_increase:{farmers:.1},upgrades:{butchering:!0}},{name:"ploughshares",type:"basic farming",costs:{metal:20},variable_increase:{farmers:.1},upgrades:{gardening:!0}},{name:"irrigation",type:"basic farming",costs:{wood:500,stone:200},variable_increase:{farmers:.1},upgrades:{ploughshares:!0}},{name:"flensing",type:"efficiency farming",title:"Flaying",costs:{metal:1e3},variable_increase:{foodSpecialChance:.001},upgrades:{domestication:!0}},{name:"macerating",type:"efficiency farming",title:"Ore Refining",costs:{leather:500,stone:500},variable_increase:{stoneSpecialChance:.001},upgrades:{extraction:!0}},{name:"croprotation",type:"improved farming",title:"Crop Rotation",costs:{herbs:5e3,piety:1e3},variable_increase:{farmers:.1}},{name:"selectivebreeding",type:"improved farming",title:"Breeding",costs:{skins:7e3,piety:2e3},variable_increase:{farmers:.1},upgrades:{croprotation:!0}},{name:"fertilizers",type:"improved farming",costs:{ore:9e3,piety:3e3},variable_increase:{farmers:.1},upgrades:{selectivebreeding:!0}},{name:"masonry",type:"construction",costs:{wood:100,stone:100},upgrades:{prospecting:!0}},{name:"construction",type:"construction",costs:{wood:1e3,stone:1e3},notes:"Allows Siege Engines",upgrades:{masonry:!0}},{name:"architecture",type:"construction",costs:{wood:1e4,stone:1e4},upgrades:{construction:!0}},{name:"tenements",type:"housing",costs:{food:200,wood:500,stone:500},upgrades:{masonry:!0}},{name:"slums",type:"housing",costs:{food:500,wood:1e3,stone:1e3},upgrades:{tenements:!0}},{name:"granaries",type:"city efficiency",costs:{wood:1e3,stone:1e3},upgrades:{construction:!0}},{name:"palisade",type:"city efficiency",costs:{wood:2e3,stone:1e3},upgrades:{architecture:!0}},{name:"weaponry",type:"weaponry",costs:{wood:500,metal:500},variable_increase:{soldier:.01,cavalry:.01}},{name:"shields",type:"weaponry",costs:{wood:500,leather:500},variable_increase:{soldier:.01,cavalry:.01}},{name:"horseback",type:"weaponry",costs:{wood:500,food:500}},{name:"wheel",type:"weaponry",costs:{wood:500,stone:500},upgrades:{masonry:!0,domestication:!0}},{name:"standard",type:"weaponry",title:"Battle Standard",costs:{leather:1e3,metal:1e3},upgrades:{writing:!0,weaponry:!0,shields:!0}},{name:"writing",type:"writing",costs:{skins:500}},{name:"administration",type:"writing",costs:{skins:1e3,stone:1e3},upgrades:{writing:!0}},{name:"codeoflaws",type:"writing",title:"Code of Laws",costs:{skins:1e3,stone:1e3},upgrades:{administration:!0}},{name:"mathematics",type:"writing",costs:{herbs:1e3,piety:1e3},upgrades:{codeoflaws:!0}},{name:"aesthetics",type:"writing",costs:{piety:5e3},upgrades:{codeoflaws:!0,responsibility:!0}},{name:"responsibility",type:"civil",costs:{skins:30}},{name:"civilservice",type:"civil",title:"Civil Service",costs:{piety:5e3},upgrades:{responsibility:!0}},{name:"feudalism",type:"civil",costs:{piety:1e4},upgrades:{civilservice:!0}},{name:"guilds",type:"civil",costs:{piety:1e4},upgrades:{feudalism:!0}},{name:"serfs",type:"civil",costs:{piety:2e4},upgrades:{guilds:!0}},{name:"nationalism",type:"civil",costs:{piety:5e4},upgrades:{serfs:!0}},{name:"trade",type:"commerce",costs:{gold:1},upgrades:{writing:!0}},{name:"currency",type:"commerce",costs:{gold:10,ore:1e3},upgrades:{writing:!0,trade:!0}},{name:"commerce",type:"commerce",costs:{gold:100,piety:1e4},upgrades:{currency:!0,civilservice:!0}},{name:"deity",type:"deity",costs:{piety:1e3},special:"choose deity",upgrades:{responsibility:!0,writing:!0}},{name:"lure",type:"deity",costs:{piety:1e3},upgrades:{deity:!0}},{name:"companion",type:"deity",costs:{piety:1e3},upgrades:{deity:!0}},{name:"comfort",type:"deity",costs:{piety:5e3},upgrades:{deity:!0}},{name:"blessing",type:"deity",costs:{piety:1e3},upgrades:{deity:!0}},{name:"waste",type:"deity",costs:{piety:1e3},upgrades:{deity:!0}},{name:"stay",type:"deity",costs:{piety:5e3},upgrades:{deity:!0}},{name:"riddle",type:"deity",costs:{piety:1e3},upgrades:{deity:!0}},{name:"throne",type:"deity",costs:{piety:1e3},upgrades:{deity:!0}},{name:"lament",type:"deity",costs:{piety:5e3},upgrades:{deity:!0}},{name:"book",type:"deity",costs:{piety:1e3},upgrades:{deity:!0}},{name:"feast",type:"deity",costs:{piety:1e3},upgrades:{deity:!0}},{name:"secrets",type:"deity",costs:{piety:5e3},upgrades:{deity:!0}}],achievements:[{name:"hamlet"},{name:"village"},{name:"smallTown",title:"Small Town"},{name:"largeTown",title:"Large Town"},{name:"smallCity",title:"Small City"},{name:"largeCity",title:"Large City"},{name:"metropolis"},{name:"smallNation",title:"Small Nation"},{name:"nation"},{name:"largeNation",title:"Large Nation"},{name:"empire"},{name:"raider"},{name:"engineer"},{name:"domination"},{name:"hated"},{name:"loved"},{name:"cat",title:"Cat!"},{name:"glaring"},{name:"clowder"},{name:"battle"},{name:"cats"},{name:"fields"},{name:"underworld"},{name:"fullHouse",title:"Full House"},{name:"plague",title:"Plagued"},{name:"ghostTown",title:"Ghost Town"},{name:"wonder"},{name:"seven"},{name:"merchant"},{name:"rushed"},{name:"neverclick",title:"Never Click"}]};a.initializeOptions("game_options",b)}(Civvies);
//# sourceMappingURL=civvies.min.js.map